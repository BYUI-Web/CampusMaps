function KMLParser(){try{var e=(new DOMParser).parseFromString(arguments[0],"text/xml");this.doc=e.childNodes[0].childNodes[1]}catch(t){var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false",e.loadXML(arguments[0]),this.doc=e.documentElement.firstChild}this.Locations=[],this.Areas=[],this.foundStyles=[],this.parseKML()}function Area(){this.name=arguments[0],this.code=arguments[1],this.info=arguments[2],this.lineColor=arguments[3][0].lineColor,this.fillColor=arguments[3][0].polyColor,this.polygons=this.createPolygons(arguments[3]),this.numberOfPolygons=this.polygons.length,this.elementID=this.code+"_poly",this.globals=arguments[4],this.state=0,this.hidden=!1,this.attachInfoWindowEvents()}function CampusMap(e){this.element=e.element?e.element:console.log("No element provided."),this.menuState=e.menuState?e.menuState:1,this.includeMenus=e.includeMenus?e.includeMenus:!0,this.KMLFiles=e.categories?e.categories:console.log("No KML Files specified"),this.device=0,this.categories=[],this.globals={doc:document,win:window},addCSS("css/map.css",this.globals),addScript("https://maps.googleapis.com/maps/api/js?v=3&sensor=false&callback=campusMap.initializeMaps",this.globals)}function addScript(e,t,o){var a=t.doc.createElement("script");a.type="text/javascript",a.src=e,"function"==typeof o&&(a.onload=o),t.doc.getElementsByTagName("body")[0].appendChild(a)}function addCSS(e,t){var o=t.doc.createElement("link");o.setAttribute("rel","stylesheet"),o.href=e,t.doc.getElementsByTagName("body")[0].appendChild(o)}function Category(){this.id=arguments[0],this.name=arguments[1],this.title=arguments[2],this.text=arguments[3],this.iconColor=arguments[4],this.link=arguments[5],this.markerLocations=[],this.polygonLocations=[],this.state=0,this.elementID=arguments[7],this.globals=arguments[6]}function Location(){this.number=arguments[8]+1,this.name=arguments[0],this.code=arguments[1],this.lat=arguments[2],this.lon=arguments[3],this.img=arguments[4],this.hours=arguments[5],this.info=arguments[6],this.link=arguments[7],this.icon=arguments[10],this.elementID=this.code+"_"+this.number,this.marker,this.globals=arguments[9],this.hidden=!1,this.createMarker(),this.createInfoWindow()}function Map(e){this.map,this.mapOptions={campusOverlayVisible:null===e.campusOverlay?!0:e.campusOverlay,campusFile:"http://www.byui.edu/Prebuilt/maps/campus_outline.xml",coordinates:void 0!==e.centerCoordinates?e.centerCoordinates:[43.815045,-111.783515]},this.embedOptions={embed:void 0===e.embed?!1:e.embed,zoom:e.zoom?e.zoom:16,mapView:e.mapView?e.mapView:"map"},this.googleMapOptions={},this.infoWindow,this.campusLayer}KMLParser.prototype.parseKML=function(){var e=this.doc.getElementsByTagName("Folder")[0];this.categoryName=this.getElementText(e.getElementsByTagName("name")[0]);var t=e.getElementsByTagName("description")[0],o=this.extractLinkText(void 0===t?"":this.getElementText(t));this.categoryText=o[1],this.link=o[0],o=this.extractSrcFromImage(this.categoryText),this.categoryColor=o[0].split("//")[1],this.categoryText=o[1],o=this.parseAllObjects(e),this.Locations=o[0],this.Areas=o[1],this.doc=null},KMLParser.prototype.parseAllObjects=function(e){var t=e.getElementsByTagName("Folder"),o=[],a=[];if(t=this.convertToArray(t),void 0!==t)for(;t.length;){var i=t.length;a.push(this.parsePolygon(t[0])),e.removeChild(t[0]),i===t.length&&t.shift()}var s=e.getElementsByTagName("Placemark");if(void 0!==s)for(var n=0,r=s.length;r>n;n++)o.push(this.parsePlacemark(s[n]));return[o,a]},KMLParser.prototype.parsePolygon=function(e){var t={};t.name=this.getElementText(e.getElementsByTagName("name")[0]),t.code=this.extractCode(this.getElementText(e.getElementsByTagName("description")[0]))[0],t.polygons=[];for(var o=e.getElementsByTagName("Placemark"),a=0,i=o.length;i>a;a++){var s=o[a],n=this.getColors(this.getElementText(s.getElementsByTagName("styleUrl")[0])),r=s.getElementsByTagName("description")[0];t.polygons.push({name:this.getElementText(s.getElementsByTagName("name")[0]),description:r?this.getElementText(r):"",coordinates:this.parseLatLng(this.getElementText(s.getElementsByTagName("coordinates")[0])),lineColor:n[0],polyColor:n[1]})}return t},KMLParser.prototype.parsePlacemark=function(e){var t={};t.name=this.getElementText(e.getElementsByTagName("name")[0]);var o=e.getElementsByTagName("description")[0],a=this.extractLinkText(o?this.getElementText(o):"");return t.link=a[0],t.description=a[1],a=this.extractSrcFromImage(t.description),t.image=a[0],t.description=a[1],a=this.extractHours(t.description),t.hours=a[0],t.description=a[1],a=this.extractCode(t.description),t.code=a[0],t.description=a[1],t.coordinates=this.parseLatLng(this.getElementText(e.getElementsByTagName("coordinates")[0])),t.icon=this.getIcon(this.getElementText(e.getElementsByTagName("styleUrl")[0])),t},KMLParser.prototype.parseLatLng=function(e){for(var t=[],o=e.replace("\n","").trim().split(" "),a=0,i=o.length;i>a;a++){var s=o[a].split(",");t.push([s[1],s[0]])}return t},KMLParser.prototype.extractLinkText=function(e){var t="";if(void 0!==e){var o=e.indexOf("<a");if(-1!==o){var a=e.indexOf("</a>")+4;t=e.substr(o,a-o),endAnchorPos=t.indexOf(">")+1,t=t.substr(endAnchorPos,t.length-4-endAnchorPos),e=e.substr(0,o)+e.substr(a)}}return[t,e]},KMLParser.prototype.extractSrcFromImage=function(e){var t="";if(void 0!==e){var o=e.indexOf("<img");if(-1!==o){var a=e.indexOf("/>")+2;t=e.substr(o,a-o),srcStartPos=t.indexOf("src=")+5,t=t.substr(srcStartPos,t.length-srcStartPos-3),e=e.substr(0,o)+e.substr(a)}}return[t,e]},KMLParser.prototype.extractHours=function(e){var t="";if(void 0!==e){var o=e.indexOf("<hours>");if(-1!==o){var a=e.indexOf("</hours>");t=e.substr(o+7,a-(o+7)),e=e.substr(0,o)+e.substr(a+8)}}return[t,e]},KMLParser.prototype.extractCode=function(e){var t="";if(void 0!==e){var o=e.indexOf("<code>");if(-1!==o){var a=e.indexOf("</code>");t=e.substr(o+6,a-(o+6)),e=e.substr(0,o)+e.substr(a+7)}}return[t,e]},KMLParser.prototype.getIcon=function(e){var t="";if(this.foundStyles[e])t=this.foundStyles[e];else{var o=this.getElement(e.substr(1),"StyleMap"),a=this.getElementText(o.getElementsByTagName("styleUrl")[0]).substr(1),i=this.getElement(a,"Style");t=this.getElementText(i.getElementsByTagName("href")[0]),this.foundStyles[e]=t}return t},KMLParser.prototype.getColors=function(e){var t="",o="",a=[];if(this.foundStyles[e])a=this.foundStyles[e];else{var i=this.getElement(e.substr(1),"StyleMap"),s=this.getElementText(i.getElementsByTagName("styleUrl")[0]).substr(1),n=this.getElement(s,"Style"),r=n.getElementsByTagName("LineStyle")[0];t=r?this.getElementText(r.getElementsByTagName("color")[0]).substr(2):"FFFFF";var l=n.getElementsByTagName("PolyStyle")[0];o=l?this.getElementText(l.getElementsByTagName("color")[0]).substr(2):"FFFFF",a=["#"+t,"#"+o],this.foundStyles[e]=a}return a},KMLParser.prototype.getElementText=function(e){return void 0===e.textContent?e.text:e.textContent},KMLParser.prototype.getElement=function(e,t){var o=null;try{o=this.doc.querySelector('[id="'+e+'"]'),null===o&&(o=this.getElementByTagName(e,t))}catch(a){o=this.getElementByTagName(e,t)}return o},KMLParser.prototype.getElementByTagName=function(e,t){for(var o=null,a=this.doc.getElementsByTagName(t),i=0,s=a.length;s>i&&null===o;i++)a[i].getAttribute("id")===e&&(o=a[i]);return o},KMLParser.prototype.convertToArray=function(e){for(var t=[],o=0,a=e.length;a>o;o++)t[o]=e[o];return t},Area.prototype.buildAreaDOM=function(){var e=this.globals.doc.createElement("a");return e.className="object polygon",e.id=this.elementID,e.setAttribute("href","#"+this.code),e.innerHTML='<div class="polygon_key" id="poly_'+this.name+'" style="border-color:'+this.lineColor+"; background-color:"+this.fillColor+'"><span>&nbsp;</span></div>',e.innerHTML+='<div class="object_name polygon">'+this.name+"</div>",e},Area.prototype.buildMapKey=function(){return'<div class="polygon_key" id="poly_key_'+this.code+'" style="border-color:'+this.borderColor+"; background-color:"+this.fillColor+'">'+this.code+"</div>"},Area.prototype.bindEventListener=function(){var e=this;campusMap.addClickHandler(this.globals.doc.getElementById(this.elementID),function(t){t.preventDefault(),e.globals.win.location.hash=e.code,e.togglePolygon()})},Area.prototype.togglePolygon=function(){var e=this.globals.doc.getElementById(this.elementID).children[0].children[0],t=this.globals.doc.getElementById("poly_key_"+this.code);0===this.state?this.showPolygons(e,t):1===this.state&&this.hidePolygons(e,t)},Area.prototype.showPolygons=function(e,t){for(var o=0;o<this.numberOfPolygons;o++)this.polygons[o].setVisible(!0);campusMap.includeMenus&&(e.className="icon-checkmark",t.parentElement.style.display="block",t.className="polygon_key active_key"),this.state=1},Area.prototype.hidePolygons=function(e,t){for(var o=0;o<this.numberOfPolygons;o++)this.polygons[o].setVisible(!1);campusMap.includeMenus&&(e.className="",t.className="polygon_key",this.globals.doc.querySelectorAll("#"+t.parentElement.id+" .active_key").length<1&&(t.parentElement.style.display="none")),this.state=0},Area.prototype.createPolygons=function(e){for(var t=[],o=0,a=e.length;a>o;o++){for(var i=[],s=0,n=e[o].coordinates.length;n>s;s++){var r=e[o].coordinates[s];i.push(new google.maps.LatLng(r[0],r[1]))}t[o]=this.createPolygon(i,e[o].lineColor,1,2,e[o].polyColor,.75),t[o].setMap(map.map)}return t},Area.prototype.createPolygon=function(e,t,o,a,i,s){return new google.maps.Polygon({paths:e,strokeColor:t,strokeOpacity:o,strokeWeight:a,fillColor:i,fillOpacity:s,visible:!1})},Area.prototype.hideAll=function(){campusMap.includeMenus&&(this.hideMapKey(),this.hideNavigation())},Area.prototype.hideMapKey=function(){var e=campusMap.includeMenus?this.globals.doc.getElementById(this.elementID).children[0].children[0]:void 0,t=campusMap.includeMenus?this.globals.doc.getElementById("poly_key_"+this.code):void 0;this.hidePolygons(e,t)},Area.prototype.hideNavigation=function(){this.hidden=!0,this.globals.doc.getElementById(this.elementID).style.display="none"},Area.prototype.showAll=function(){campusMap.includeMenus&&(this.showMapKey(),this.showNavigation())},Area.prototype.showMapKey=function(){var e=campusMap.includeMenus?this.globals.doc.getElementById(this.elementID).children[0].children[0]:void 0,t=campusMap.includeMenus?this.globals.doc.getElementById("poly_key_"+this.code):void 0;this.showPolygons(e,t)},Area.prototype.showNavigation=function(){this.hidden=!1,this.globals.doc.getElementById(this.elementID).style.display="block"},Area.prototype.attachInfoWindowEvents=function(){for(var e=0;e<this.numberOfPolygons;e++)map.createPolygonInfoWindow(this.polygons[e],this)},CampusMap.prototype.initializeMaps=function(){if(map.embedOptions.embed){var e=this.globals.doc.getElementById(this.element);e.className+=" embed"}this.buildHTML(),map.initiateMap(this.globals),this.detectDevice(),this.loadKMLFiles().then(function(){this.bindAllEvents()}.bind(this)),this.includeMenus&&(0===this.device&&this.hideMenu(),this.bindMenuButton()),this.handleResize(),google.maps.event.addListenerOnce(map.map,"tilesloaded",function(){campusMap.setMapHeight(),campusMap.includeMenus&&(campusMap.buildMapKey(),campusMap.initializeSearch()),map.embedOptions.embed===!1?campusMap.anchorLocation():campusMap.includeMenus||campusMap.displayAll(),campusMap.getLocation()})},CampusMap.prototype.buildHTML=function(){var e=this.includeMenus?'<div id="title"><h1 id="heading">BYU-Idaho Campus Map</h1><a style="display: none;" id="device_type" href="#" onmousedown="toggleDevice(); return false;" title="Switch Device Type"><div id="device_container"><div class="device icon-desktop"></div><div class="device icon-mobile"></div></div></a><a id="menu_button" class="icon-settings" href="#" title="Open Menu. Click this or press [space] bar"></a></div>':"";e+='<div id="container" name="container">',e+=this.includeMenus?'<div id="menu" name="menu" style="display:block; z-index: 2;"><div id="inner_menu" class="scrolling-element-class" ><div id="object_search"><div class="search-wrapper"><input type="text" placeholder="Search"/><span class="icon-cancel"></span></div></div><nav id="categories" class="child-element"></nav><!-- // categories --><div id="floor-plans-notification"><p>Floor plans of each building are available on <a href="https://www.google.com/maps/place/Brigham+Young+University+Idaho/@43.814113,-111.783878,17z/data=!4m2!3m1!1s0x53540b03dc48a5cf:0x1e5534d3c38ef412" target="_blank">Google Maps</a></p></div></div><!-- // inner menu --><div id="notification" class="hybrid"><a id="info" title="[Coming Soon] More info about this map" class="icon-info" href="#"></a><a id="feedback" title="Submit feedback about this map" class="icon-feedback" target="_blank" href="http://www.byui.edu/feedback/maps"></a></div></div><!-- // menu -->':"",e+='<div id="map_canvas"><div id="nojs-msg"><br/>This BYU-Idaho Campus Map application requires Javascript to run. <br/>Your device or browser doesn\'t appear to have JavaScript enabled. <br/>Please enable it and try again, or try another device or browser.</div></div>',e+='<div id="map_keys"></div>',this.globals.doc.getElementById(this.element).innerHTML=e},CampusMap.prototype.loadKMLFiles=function(){{var e=this,t=localStorage?localStorage.mapData:void 0;t?JSON.parse(t):{}}return Promise.all(this.KMLFiles.map(this.loadKMLFile)).then(function(t){t.forEach(function(t){var o=new KMLParser(t);e.buildCategories(o)})})},CampusMap.prototype.loadKMLFile=function(e){return new Promise(function(t){var o;o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o.onreadystatechange=function(){4==o.readyState&&t(o.responseText)},o.open("GET",e),o.send()})},CampusMap.prototype.buildCategories=function(e){var t=this.categories.length;if(this.categories[t]=new Category(t+1,e.categoryName,e.categoryName,e.categoryText,e.categoryColor,e.link,this.globals,"cat_"+(t+1)),this.categories[t].markerLocations=this.parseLocations(e.Locations,"http://www.byui.edu/Prebuilt/maps/imgs/icons/numeral-icons/"+e.categoryColor+"/"),this.categories[t].polygonLocations=this.parseAreas(e.Areas),this.includeMenus){var o=this.globals.doc.getElementById("categories"),a=this.categories[t].getCatDOMObj();o.appendChild(a)}},CampusMap.prototype.parseLocations=function(e,t){for(var o=[],a=0,i=e.length;i>a;a++){var s=e[a];o.push(new Location(s.name,s.code,s.coordinates[0][0],s.coordinates[0][1],s.image,s.hours,s.description,s.link,a,this.globals,this.includeMenus?t+(a+1)+".png":s.icon))}return o},CampusMap.prototype.parseAreas=function(e){for(var t=[],o=0,a=e.length;a>o;o++){var i=e[o];t.push(new Area(i.name,i.code,i.description,i.polygons,this.globals))}return t},CampusMap.prototype.detectDevice=function(){var e=this.globals.doc.getElementById(this.element).offsetWidth;this.device=800>e?0:1},CampusMap.prototype.bindAllEvents=function(){for(var e,t=0,o=this.categories.length;o>t;t++)if(e=this.categories[t],this.includeMenus){if(e.bindEventListener(),e.markerLocations)for(var a=0,i=e.markerLocations.length;i>a;a++)e.markerLocations[a].bindEventListener();if(e.polygonLocations)for(var s=0,n=e.polygonLocations.length;n>s;s++)e.polygonLocations[s].bindEventListener()}},CampusMap.prototype.buildMapKey=function(){for(var e="",t=0,o=this.categories.length;o>t;t++)e+=this.categories[t].buildMapKey();for(this.globals.doc.getElementById("map_keys").innerHTML=e,t=0,o=this.categories.length;o>t;t++)this.addClickHandler(this.globals.doc.getElementById("poly_key_"+(t+1)).getElementsByTagName("a")[0],campusMap.hideKey)},CampusMap.prototype.hideKey=function(){this.parentElement.style.display="none"},CampusMap.prototype.getMapHeight=function(){var e=this.globals.doc.getElementById(this.element).offsetHeight;return this.includeMenus?e-57:e},CampusMap.prototype.setMapHeight=function(){var e=this.getMapHeight(),t=this.globals.doc.getElementById("container");t.style.height=e+"px";var o=this.globals.doc.getElementById("map_canvas");o.style.height=e+"px"},CampusMap.prototype.initializeSearch=function(){var e=this.globals.doc.getElementById("object_search").children[0].children[0];this.addKeyUpListener(e,function(){campusMap.performSearch(e.value)}),this.addClickHandler(e.nextSibling,function(){e.value="",campusMap.performSearch("")})},CampusMap.prototype.performSearch=function(e){if(""!==e){e=e.toLowerCase();for(var t=0,o=this.categories.length;o>t;t++){var a=this.categories[t],i=(a.markerLocations?a.markerLocations.length:0)+(a.polygonLocations?a.polygonLocations.length:0);if(a.markerLocations)for(var s=0,n=a.markerLocations.length;n>s;s++)-1===a.markerLocations[s].name.toLowerCase().indexOf(e)?(a.markerLocations[s].hideAll(),i--):a.markerLocations[s].showAll();if(a.polygonLocations)for(var r=0,l=a.polygonLocations.length;l>r;r++)-1===a.polygonLocations[r].name.toLowerCase().indexOf(e)?(a.polygonLocations[r].hideAll(),i--):a.polygonLocations[r].showAll();var c=this.globals.doc.getElementById(a.elementID).parentElement.children[1];i>0?a.openCategory(c):a.closeCategory(c)}}else for(var p=0,d=this.categories.length;d>p;p++){var h=this.categories[p];h.markerLocations&&this.categories[p].hideAllMarkers(),h.polygonLocations&&this.categories[p].hideAllPolygons();var m=this.globals.doc.getElementById(h.elementID).parentElement.children[1];h.closeCategory(m)}},CampusMap.prototype.bindMenuButton=function(){this.addClickHandler(this.globals.doc.getElementById("menu_button"),function(){campusMap.toggleMenu()})},CampusMap.prototype.toggleMenu=function(){this.menuState?this.hideMenu():this.showMenu()},CampusMap.prototype.hideMenu=function(){this.menuState=0;var e=this.globals.doc.getElementById("menu");if(1===this.device)this.updateTransform(e,300,0);else{var t=this.globals.doc.getElementById(this.element).offsetWidth;this.updateTransform(e,t,0)}},CampusMap.prototype.showMenu=function(){this.menuState=1,this.updateTransform(this.globals.doc.getElementById("menu"),0,0)},CampusMap.prototype.anchorLocation=function(){if(window.location.hash){var e=window.location.hash.substr(1),t=this.findObject(e);t.showAll(),void 0===t.polygons&&this.fireEvent(this.globals.doc.getElementById(t.elementID),"click")}},CampusMap.prototype.findObject=function(e){for(var t=null,o=0,a=this.categories.length;a>o&&null===t;o++){var i=this.categories[o];if(i.markerLocations)for(var s=0,n=i.markerLocations.length;n>s&&null===t;s++)i.markerLocations[s].code===e&&(t=i.markerLocations[s]);if(i.polygonLocations)for(var r=0,l=i.polygonLocations.length;l>r&&null===t;r++)i.polygonLocations[r].code===e&&(t=i.polygonLocations[r])}return t},CampusMap.prototype.displayAll=function(){for(var e=0,t=this.categories.length;t>e;e++){var o=this.categories[e];if(o.markerLocations)for(var a=0,i=o.markerLocations.length;i>a;a++)o.markerLocations[a].showAll();if(o.polygonLocations)for(var s=0,n=o.polygonLocations.length;n>s;s++)o.polygonLocations[s].showPolygons()}},CampusMap.prototype.fireEvent=function(e,t){if(document.createEvent){var o=document.createEvent("HTMLEvents");return o.initEvent(t,!0,!0),!e.dispatchEvent(o)}var a=document.createEventObject();return e.fireEvent("on"+t,a)},CampusMap.prototype.addClickHandler=function(e,t){try{e.addEventListener("click",t)}catch(o){e.attachEvent("onclick",t)}},CampusMap.prototype.addKeyUpListener=function(e,t){try{e.addEventListener("keyup",t)}catch(o){e.attachEvent("onkeyup",t)}},CampusMap.prototype.getLocation=function(){navigator.geolocation&&0===this.device&&navigator.geolocation.getCurrentPosition(this.showPosition)},CampusMap.prototype.showPosition=function(e){var t=map.createMarker(e.coords.latitude,e.coords.longitude,"You are here","imgs/icons/youarehere.png");t.setVisible(!0)},CampusMap.prototype.handleResize=function(){this.globals.win.addEventListener("resize",function(){if(campusMap.detectDevice(),0===campusMap.menuState){var e=campusMap.globals.doc.getElementById("menu");if(1===campusMap.device)campusMap.updateTransform(e,300,0);else{e.setAttribute("class",e.getAttribute("class")+" no-animate");var t=campusMap.globals.doc.getElementById(campusMap.element).offsetWidth;campusMap.updateTransform(e,t,0),e.offsetHeight,e.setAttribute("class",e.getAttribute("class").replace(" no-animate",""))}}campusMap.setMapHeight()})},CampusMap.prototype.updateTransform=function(e,t,o){e.style.webkitTransform="translate("+t+"px,"+o+"px)",e.style.mozTransform="translate("+t+"px,"+o+"px)",e.style.transform="translate("+t+"px,"+o+"px)"};var campusMap,map;addScript("https://s7.addthis.com/js/300/addthis_widget.js#pubid=xa-51f6872a25a1fb8c",{win:window,doc:document}),addScript("js/vendor/promise.min.js",{win:window,doc:document},function(){campusMap=new CampusMap(options),map=new Map(options)}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Category.prototype.buildCatDOM=function(){var e=this.globals.doc.createElement("a");return e.className="category_bar",e.id=this.elementID,e.setAttribute("href","#"),e.innerHTML+='<img class="cat_icon" src="https://www.byui.edu/Prebuilt/maps/imgs/icons/blank-colors/'+this.iconColor+'.png" />',e.innerHTML+='<span class="category_name">'+this.title+"</span>",e},Category.prototype.getCatDOMObj=function(){var e=this.globals.doc.createElement("div");e.className="category",e.appendChild(this.buildCatDOM());var t=this.globals.doc.createElement("div");t.className="cat_container",t.innerHTML='<div class="cat_info"><p>'+this.text+'</p><a href="'+this.link+'" target="_blank">'+this.title+" website</a></div>";var o=this.globals.doc.createElement("div");return o=this.appendLocations(o),o=this.appendAreas(o),t.appendChild(o),e.appendChild(t),e},Category.prototype.appendLocations=function(e){if(this.markerLocations)for(var t=0,o=this.markerLocations.length;o>t;t++)e.appendChild(this.markerLocations[t].buildLocationDOM());return e},Category.prototype.appendAreas=function(e){if(this.polygonLocations)for(var t=0,o=this.polygonLocations.length;o>t;t++)e.appendChild(this.polygonLocations[t].buildAreaDOM());return e},Category.prototype.bindEventListener=function(){var e=this;campusMap.addClickHandler(this.globals.doc.getElementById(this.elementID),function(t){t.preventDefault(),e.toggle()})},Category.prototype.toggle=function(){var e=this.globals.doc.getElementById(this.elementID).parentElement.children[1];map.infoWindow.close(),this.toggleMarkersVisibility(),0===this.state?this.openCategory(e):this.closeCategory(e)},Category.prototype.openCategory=function(e){e.style.display="block",e.style.height="100%",this.state=1},Category.prototype.closeCategory=function(e){e.style.display="none",e.style.height="0",this.state=0},Category.prototype.toggleMarkersVisibility=function(){0===this.state?this.showAllMarkers():this.hideAllMarkers()},Category.prototype.showAllMarkers=function(){if(this.markerLocations)for(var e=0,t=this.markerLocations.length;t>e;e++)this.markerLocations[e].hidden||this.markerLocations[e].marker.setVisible(!0)},Category.prototype.hideAllMarkers=function(){if(this.markerLocations)for(var e=0,t=this.markerLocations.length;t>e;e++)this.markerLocations[e].showNavigation(),this.markerLocations[e].hideMarker()},Category.prototype.hideAllPolygons=function(){if(this.polygonLocations)for(var e=0,t=this.polygonLocations.length;t>e;e++)this.polygonLocations[e].showNavigation(),this.polygonLocations[e].hideMapKey()},Category.prototype.buildMapKey=function(){var e="";if(this.polygonLocations){e="<div id='poly_key_"+this.id+"' class='map_key_category map_key_"+this.name+"' style='display: none'><div class='key_title'>"+this.name+" Map Key</div><a class='close icon-cancel nolink' href='#'></a>";for(var t=0,o=this.polygonLocations.length;o>t;t++)e+=this.polygonLocations[t].buildMapKey();e+="</div>"}return e},Location.prototype.buildLocationDOM=function(){var e=this.globals.doc.createElement("a");return e.className="object marker_object",e.id=this.elementID,e.name=this.name,e.setAttribute("href","#"+this.code),e.innerHTML+='<img  class="obj_icon" src="'+this.icon+'" alt="'+name+'" />',e.innerHTML+='<div class="object_name">'+this.name+"</div>",e},Location.prototype.bindEventListener=function(){var e=this;campusMap.addClickHandler(this.globals.doc.getElementById(this.elementID),function(t){t.preventDefault(),e.globals.win.location.hash=e.code,e.panToMarker(),0===campusMap.device&&campusMap.hideMenu()})},Location.prototype.panToMarker=function(){var e=google.maps.event.addListener(map,"moveend",function(){map.map.fromLatLngToDivPixel(this.marker.getPosition());google.maps.event.removeListener(e)});map.map.panTo(this.marker.getPosition()),google.maps.event.trigger(this.marker,"click")},Location.prototype.createMarker=function(){this.marker=map.createMarker(this.lat,this.lon,this.name,this.icon)},Location.prototype.createInfoWindow=function(){map.createInfoWindow(this.marker,this)},Location.prototype.hideAll=function(){this.hideNavigation(),campusMap.includeMenus&&this.hideMarker()},Location.prototype.hideMarker=function(){this.marker.setVisible(!1)},Location.prototype.hideNavigation=function(){this.hidden=!0,this.globals.doc.getElementById(this.elementID).style.display="none"},Location.prototype.showAll=function(){this.showMarker(),campusMap.includeMenus&&this.showNavigation()},Location.prototype.showMarker=function(){this.marker.setVisible(!0)},Location.prototype.showNavigation=function(){this.hidden=!1,this.globals.doc.getElementById(this.elementID).style.display="block"},Map.prototype.initiateMap=function(e){this.setGoogleMapOptions(),this.setGoogleMap(e),this.setInfoWindow(),this.setCampusLayer()},Map.prototype.setGoogleMapOptions=function(){var e;e="map"===this.embedOptions.mapView?google.maps.MapTypeId.ROADMAP:google.maps.MapTypeId.HYBRID,this.googleMapOptions={zoom:this.embedOptions.embed?this.embedOptions.zoom:16,center:new google.maps.LatLng(this.mapOptions.coordinates[0],this.mapOptions.coordinates[1]),mapTypeId:e,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN]}}},Map.prototype.setGoogleMap=function(e){google.maps.Polygon.prototype.getCenter=function(){for(var e=this.getPaths().getArray()[0].b,t=e[0].mb,o=e[0].nb,a=e[0].mb,i=e[0].nb,s=1,n=e.length;n>s;s++)e[s].mb<t?t=e[s].mb:e[s].mb>a&&(a=e[s].mb),e[s].nb<o?o=e[s].nb:e[s].nb>i&&(i=e[s].nb);var r=t+(a-t)/2,l=o+(i-o)/2;return new google.maps.LatLng(r,l)},this.map=new google.maps.Map(e.doc.getElementById("map_canvas"),this.googleMapOptions)},Map.prototype.setInfoWindow=function(){this.infoWindow=new google.maps.InfoWindow},Map.prototype.setCampusLayer=function(){this.campusLayer=new google.maps.KmlLayer(this.mapOptions.campusFile,{suppressInfoWindows:!0,map:this.map,preserveViewport:!0,zoom:18})},Map.prototype.createMarker=function(e,t,o,a){return new google.maps.Marker({position:new google.maps.LatLng(e,t),visible:!1,map:this.map,title:o,icon:a})},Map.prototype.createInfoWindow=function(e,t){var o=this.infoWindow,a=this.map;google.maps.event.addListener(e,"click",function(){var i,s="",n=t.name,r=t.link,l=t.hours,c=t.phone,p=t.address,d=t.info;t.img&&(i=-1===t.img.indexOf(":")?"Prebuilt/maps/imgs/objects/"+t.img:t.img),s+='<div class="infopane">',s+="<h2>"+n+"</h2>",s+="<div>",i&&(s+='<img src="'+i+'" alt="'+n+'"',s+=' style="float:right;margin:0 0 10px 10px;',0===campusMap.device&&window.map.embedOptions.embed===!0&&(s+=" width:100px; height:75px;"),s+='"/>'),s+='<div class="button-div">',c&&(s+='<a class="phone-call btn btn-large btn-primary icon-call" href="tel:'+c+'" ></a>'),r&&(s+='<a href="'+r+'" target="_blank" class="btn btn-large btn-primary">More Info</a>'),s+="</div>",l&&(s+='<div class="info-row info-hours"><strong>Hours:</strong> '+l+"</div>"),c&&(s+='<div class="info-row info-phone"><strong>Phone:</strong> '+c+"</div>"),p&&(s+='<div class="info-row info-address"><strong>Address:</strong> '+p+"</div>"),d&&(s+='<div class="info-row info-info"><strong>Info:</strong> '+d+"</div>"),s+="</div>",s+="</div>",s+='<div class="addthis_toolbox addthis_32x32_style addthis_default_style">',s+="<p>Share this location.</p>",s+='<a class="addthis_button_facebook social_button"></a>',s+='<a class="addthis_button_google_plusone_share social_button"></a>',s+='<a class="addthis_button_twitter social_button"></a>',s+='<a class="addthis_button_compact social_button"></a>',s+="</div>",o.setContent(s),o.open(a,e);var h={url:"http://www.byui.edu/maps#"+t.code,title:t.name};addthis.toolbox(".addthis_toolbox",{},h)})},Map.prototype.createPolygonInfoWindow=function(e,t){var o=this.infoWindow,a=this.map;google.maps.event.addListener(e,"click",function(i){var s="",n=t.name,r=(t.code,t.info);s+='<div class="infopane">',s+="<h2>"+n+"</h2>",s+="<div>",r&&(s+='<div class="info-row info-info"><strong>Info:</strong> '+r+"</div>"),s+="</div>",s+="</div>",s+='<div class="addthis_toolbox addthis_32x32_style addthis_default_style">',s+="<p>Share this location.</p>",s+='<a class="addthis_button_facebook social_button"></a>',s+='<a class="addthis_button_google_plusone_share social_button"></a>',s+='<a class="addthis_button_twitter social_button"></a>',s+='<a class="addthis_button_compact social_button"></a>',s+="</div>",o.setContent(s);e.getCenter();o.open(a),o.setPosition(i.latLng);var l={url:"http://www.byui.edu/maps#"+t.code,title:t.name};addthis.toolbox(".addthis_toolbox",{},l)})};